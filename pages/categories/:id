<!-- begin #page - the container for everything but header -->
<div id="page">	
	<div class="sparkNow">
		<div class="container clearfix">	
		
			<!-- begin equalHeights columns 3 -->
			<h3 class="short_headline sparkNowTitle"><span><b>SPARKING</b>NOW</span></h3>
                <div class="row-fluid equalHero equalHeights" id="main-content">
                    <script id="blog_tile_template" type="x-tmpl-mustache">
            			<div class="span4 sparkNowTile">
            				<div class="sparkNowTileTop">
            				    {{#tag_first}}
            				        <a href="/posts/{{slug}}" class="sparkNowTileTag">{{.}}</a>
                                {{/tag_first}}
            					<a href="/posts/{{slug}}" class="sparkNowTileImg">
            						<img src="{{ image_url }}" class="aligncenter" alt="" />
            					</a>
            				</div>
            				<div class="sparkNowTileTitle"><a href="/posts/{{slug}}"><h3>{{ title }}</h3></a></div>
            				<a class="sparkNowTileRead" href="/posts/{{slug}}">READ</a>
            				<a class="{{impression_tile_class}}" href="/posts/{{slug}}">{{ impression_count }}</a>
            			</div>
				    </script>
				</div>
	   		<div class="sparkNowMore">
				<a href="/posts?tag=video">SEE MORE</a>
			</div>
		</div>
	</div>
</div>


<style>
    .sparkNow{
        margin-top:3%;
    }
</style>
<script>
$(document).ready(function() {
    function renderPageData(){
        var pathArray = window.location.pathname.split( '/' );
        var category = pathArray[pathArray.length-1];

        renderPostListTemplate('#blog_tile_template', '#main-content',getPostList());
        
        // $('#loading').hide();
        // $('#page_content').fadeIn('fast');
    }
    
    loadMallData(renderPageData);
});

function renderPostListTemplate(blog_template, blog_block, post){

    var item_list = [];
    var item_rendered = [];
    var blog_template_html = $(blog_template).html();
    Mustache.parse(blog_template_html);   // optional, speeds up future uses
    $.each( post , function( key, val ) {
        item_list.push(val);
    });
    $.each( item_list , function(key,val){
        if(val.tag.length != 0){
            val.tag_first = val.tag[0];
        }
        if(val.impression_count < 20){
            val.impression_tile_class = "sparkNowTileReadCount1";
        }else if (val.impression_count < 50){
            val.impression_tile_class = "sparkNowTileReadCount2";
        }else if (val.impression_count < 100){
            val.impression_tile_class = "sparkNowTileReadCount3";
        }else{
            val.impression_tile_class = "sparkNowTileReadCount4";
        }
        console.log(val);
    });
    item_list.sort(function(a, b){
        if(a.publish_date > b.publish_date) return -1;
        if(a.publish_date < b.publish_date) return 1;
        return 0;
    });
    $.each( item_list , function( key, val ) {
        var blog_rendered = Mustache.render(blog_template_html,val);
        item_rendered.push(blog_rendered);
    });
    $(blog_block).html(item_rendered.join(''));
}


</script>